@echo off
REM Setup script to fix database.py import issues (Windows)
REM Run this script in your project root directory

echo ================================================
echo üîß Fixing Database Import Structure
echo ================================================
echo.

REM Check if database.py exists
if not exist "database.py" if not exist "utils\database.py" (
    echo ‚ùå Error: database.py not found!
    echo Please make sure database.py exists in your project
    pause
    exit /b 1
)

REM Create utils directory if it doesn't exist
if not exist "utils" (
    echo üìÅ Creating utils\ directory...
    mkdir utils
    echo ‚úÖ utils\ created
) else (
    echo ‚úÖ utils\ already exists
)

REM Create __init__.py if it doesn't exist
if not exist "utils\__init__.py" (
    echo üìù Creating utils\__init__.py...
    type nul > utils\__init__.py
    echo ‚úÖ utils\__init__.py created
) else (
    echo ‚úÖ utils\__init__.py already exists
)

REM Move database.py if it's in root
if exist "database.py" if not exist "utils\database.py" (
    echo üì¶ Moving database.py to utils\...
    move database.py utils\
    echo ‚úÖ database.py moved to utils\
) else if exist "utils\database.py" (
    echo ‚úÖ utils\database.py already in correct location
)

REM Verify structure
echo.
echo üìã Verifying project structure:
echo ---

if exist "utils\" (
    echo ‚úÖ utils\ folder exists
) else (
    echo ‚ùå utils\ folder missing
)

if exist "utils\__init__.py" (
    echo ‚úÖ utils\__init__.py exists
) else (
    echo ‚ùå utils\__init__.py missing
)

if exist "utils\database.py" (
    echo ‚úÖ utils\database.py exists
) else (
    echo ‚ùå utils\database.py missing
)

REM Check Python packages
echo.
echo üì¶ Checking Python packages:
echo ---

python -c "import pymysql" 2>nul && echo ‚úÖ pymysql installed || echo ‚ùå pymysql not installed - run: pip install pymysql
python -c "import pandas" 2>nul && echo ‚úÖ pandas installed || echo ‚ùå pandas not installed - run: pip install pandas
python -c "import dotenv" 2>nul && echo ‚úÖ python-dotenv installed || echo ‚ùå python-dotenv not installed - run: pip install python-dotenv
python -c "import streamlit" 2>nul && echo ‚úÖ streamlit installed || echo ‚ùå streamlit not installed - run: pip install streamlit

REM Test import
echo.
echo üß™ Testing import:
echo ---

python -c "from utils.database import test_connection; print('‚úÖ Import successful!')" 2>nul
if %errorlevel% equ 0 (
    echo ‚úÖ Database module imports correctly!
    
    REM Test connection
    echo.
    echo üîå Testing database connection:
    echo ---
    python -c "from utils.database import test_connection; result = test_connection(); print('‚úÖ Connection successful!' if result else '‚ùå Connection failed - check .env file')" 2>nul
) else (
    echo ‚ùå Import failed - there may be other issues
)

echo.
echo ================================================
echo ‚úÖ Setup Complete!
echo ================================================
echo.
echo Next steps:
echo 1. Make sure your .env file has correct database credentials
echo 2. Run: streamlit run Home.py
echo.

pause